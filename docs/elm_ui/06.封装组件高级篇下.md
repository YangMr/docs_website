# 封装组件高级篇（下）

## 6-1 本章概述

### 本章概述

在上一个章节，我们已经编写了高级组件中的表单组件，这一章节我们继续编写高级组件-表格组件。

### 将收获什么

- 支持`element-plus`表格所有组件
- 支持`element-plus`表格所有属性
- 支持`element-plus`表格所有方法
- 所有表格项完全可配置
- 支持单元格可编辑
- 支持行编辑
- 支持表格分页

### 学习难点

- 表格配置项设计
- 表格逻辑梳理
- 如何支持所有组件、属性和方法
- 如何支持单元格可编辑
- 如何支持行编辑
- 如何支持表格分页
- 如何与实际业务结合

### 学习方法

- 要有耐心，不要一心想着写代码，觉得需求和设计不重要
- 一定要动手敲，不要光看不做
- 有问题及时交流

### 注意事项

- 编写组件一定要从使用者出发，所以要考虑所以情况
- 尽量利用已有或现成的组件
- 遇到问题慢慢分析，不要怕遇到问题





## 6-2 表格组件-一个强大的表格应该具备哪些功能

#### 1. 创建table组件并注册

`components/table/src/index.vue`

```vue
<template>
  <div>table组件</div>
</template>

<script lang="ts" setup>

</script>

<style scoped lang="scss"></style>

```

`components/table/index.ts`

```ts
import { App } from "vue";
import Table from "./src/index.vue";

export default {
  install(app: App) {
    app.component("m-table", Table);
  },
};

```

`components/index.ts`

```ts
import { App } from "vue";
import chooseArea from "./chooseArea";
import chooseIcon from "./chooseIcon";
import menu from "./menu";
import form from "./form";
import modalForm from "./modalForm";
import table from "./table";

const components = [chooseArea, chooseIcon, menu, form, modalForm, table];

export default {
  install(app: App) {
    components.map((item) => {
      app.use(item);
    });
  },
};

```

#### 2. 创建table页面以及使用table组件, 并配置table页面路由

`views/table/index.vue`

```vue
<template>
  <m-table></m-table>
</template>

<script lang="ts" setup>

</script>

<style scoped lang="scss"></style>

```

`router/index.ts`

```ts
import { createRouter, createWebHistory, RouteRecordRaw } from "vue-router";
import Home from "../views/Home.vue";
import Container from "../components/container/src/index.vue";
const routes: RouteRecordRaw[] = [
  {
    path: "/",
    component: Container,
    children: [
      {
        path: "/",
        component: Home,
      },
      {
        path: "/chooseIcon",
        component: () => import("../views/chooseIcon/index.vue"),
      },
      {
        path: "/chooseArea",
        component: () => import("../views/chooseArea/index.vue"),
      },
      {
        path: "/menu",
        component: () => import("../views/menu/index.vue"),
      },
      {
        path: "/form",
        component: () => import("../views/form/index.vue"),
      },
      {
        path: "/modalForm",
        component: () => import("../views/modalForm/index.vue"),
      },
      {
        path: "/table",
        component: () => import("../views/table/index.vue"),
      },
    ],
  },
];

const router = createRouter({
  routes,
  history: createWebHistory(),
});

export default router;

```



## 6-3 表格组件-使用 ts 定义表格组件需要的类型

#### 1. 定义表格配置项需要的ts类型

`components/table/src/types.ts`

```ts
export interface TableOptions {
  // 字段名称
  prop?: string;
  // 表头
  label: string;
  // 对应列的宽度
  width?: string | number;
  // 对齐方式
  align?: "left" | "center" | "right";
  // 自定义列模板的插槽名
  slot?: string;
  // 是否是操作项
  action?: boolean;
  // 是否可以编辑
  editable?: boolean;
}

```

#### 2. table组件接受父组件传递的数据

`components/table/src/index.vue`

```vue
<template>
  <div>table组件</div>
</template>

<script lang="ts" setup>
import type { PropType } from "vue";
import type { TableOptions } from "./types";

defineProps({
  // 表格配置项
  options: {
    type: Array as PropType<TableOptions[]>,
    required: true,
  },
  // 表格数据
  data: {
    type: Array as PropType<any[]>,
    required: true,
  },
});
</script>

<style scoped lang="scss"></style>
```



## 6-4 表格组件-通过配置的数据完成一个基础版表格

#### 1. 在table页面定义表格数据

```ts
// 表格数据
const tableData = [
  {
    date: "2016-05-03",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-02",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-04",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-01",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
];

```



#### 2. 在table页面定义表格配置项数据

```ts
<script lang="ts" setup>
import type { TableOptions } from "../../components/table/src/types";

// 表格数据
const tableData = [
  {
    date: "2016-05-03",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-02",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-04",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-01",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
];

// 表格配置
let options: TableOptions[] = [
  {
    label: "日期",
    prop: "date",
    align: "center",
  },
  {
    label: "姓名",
    prop: "name",
    align: "center",
  },
  {
    label: "地址",
    prop: "address",
    align: "center",
  },
];
</script>
```



#### 3. 在table页面将表格数据与表格配置项数据传递到子组件

```vue
<template>
  <m-table :data="tableData" :options="options"></m-table>
</template>

<script lang="ts" setup>
import type { TableOptions } from "../../components/table/src/types";

// 表格数据
const tableData = [
  {
    date: "2016-05-03",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-02",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-04",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-01",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
];

// 表格配置
let options: TableOptions[] = [
  {
    label: "日期",
    prop: "date",
    align: "center",
  },
  {
    label: "姓名",
    prop: "name",
    align: "center",
  },
  {
    label: "地址",
    prop: "address",
    align: "center",
  },
];
</script>

<style scoped lang="scss"></style>

```



#### 4. 在table组件根据表格数据与表格配置项数据渲染表格

`components/table/src/index.vue`

```vue
<template>
  <el-table :data="data">
    <template v-for="(item, index) in options" :key="index">
      <el-table-column
        :label="item.label"
        :prop="item.prop"
        :align="item.align"
        :width="item.width"
      ></el-table-column>
    </template>
  </el-table>
</template>

<script lang="ts" setup>
import type { PropType } from "vue";
import type { TableOptions } from "./types";

defineProps({
  // 表格配置项
  options: {
    type: Array as PropType<TableOptions[]>,
    required: true,
  },
  // 表格数据
  data: {
    type: Array as PropType<any[]>,
    required: true,
  },
});
</script>

<style scoped lang="scss"></style>

```



## 6-5 表格组件-巧用插槽实现操作项和自定义列数据

#### 1. 定义表格配置项操作项ts类型

```ts
export interface TableOptions {
  // 字段名称
  prop?: string;
  // 表头
  label: string;
  // 对应列的宽度
  width?: string | number;
  // 对齐方式
  align?: "left" | "center" | "right";
  // 自定义列模板的插槽名
  slot?: string;
  // 是否是操作项
  action?: boolean;
}

```



#### 2. 定义操作项数据

```ts
// 表格配置
let options: TableOptions[] = [
  {
    label: "日期",
    prop: "date",
    align: "center",
  },
  {
    label: "姓名",
    prop: "name",
    align: "center",
  },
  {
    label: "地址",
    prop: "address",
    align: "center",
  },
  {
    label: "操作",
    align: "center",
    action: true,
  },
];
```



#### 3. 过滤操作选项之后的配置

```ts
<template>
  <el-table :data="data">
    <template v-for="(item, index) in tableOptions" :key="index">
      <el-table-column
        :label="item.label"
        :prop="item.prop"
        :align="item.align"
        :width="item.width"
      ></el-table-column>
    </template>
  </el-table>
</template>

<script lang="ts" setup>
import { computed, type PropType } from "vue";
import type { TableOptions } from "./types";

let props = defineProps({
  // 表格配置项
  options: {
    type: Array as PropType<TableOptions[]>,
    required: true,
  },
  // 表格数据
  data: {
    type: Array as PropType<any[]>,
    required: true,
  },
});

// 过滤操作项配置
let tableOptions = computed(() => {
  return props.options.filter((item) => !item.action);
});
</script>

<style scoped lang="scss"></style>

```



#### 4. 找出操作项配置

```ts
<script lang="ts" setup>
import { computed, type PropType } from "vue";
import type { TableOptions } from "./types";

let props = defineProps({
  // 表格配置项
  options: {
    type: Array as PropType<TableOptions[]>,
    required: true,
  },
  // 表格数据
  data: {
    type: Array as PropType<any[]>,
    required: true,
  },
});

// 过滤操作项配置
let tableOptions = computed(() => {
  return props.options.filter((item) => !item.action);
});

// 找出操作项配置
let actionOptions = computed(() => {
  return props.options.find((item) => item.action);
});

console.log("actionOptions", actionOptions);
</script>
```



#### 5. 使用插槽渲染操作项

```vue
<template>
  <el-table :data="data">
    <template v-for="(item, index) in tableOptions" :key="index">
      <el-table-column
        :label="item.label"
        :prop="item.prop"
        :align="item.align"
        :width="item.width"
      ></el-table-column>
    </template>

    <el-table-column
      :label="actionOptions!.label"
      :align="actionOptions!.align"
      :width="actionOptions!.width"
    >
      <template #default="scope">
        <slot name="action" :scope="scope"></slot>
      </template>
    </el-table-column>
  </el-table>
</template>

```



#### 6. 通过父组件自定义操作项

```vue
<template>
  <m-table :data="tableData" :options="options">
    <template #action="{ scope }">
      <el-button type="primary" size="small" @click="edit(scope)"
        >编辑</el-button
      >
      <el-button type="danger" size="small" @click="remove(scope)"
        >删除</el-button
      >
    </template>
  </m-table>
</template>

<script lang="ts" setup>
import type { TableOptions } from "../../components/table/src/types";

// 表格数据
const tableData = [
  {
    date: "2016-05-03",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-02",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-04",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-01",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
];

// 表格配置
let options: TableOptions[] = [
  {
    label: "日期",
    prop: "date",
    align: "center",
  },
  {
    label: "姓名",
    prop: "name",
    align: "center",
  },
  {
    label: "地址",
    prop: "address",
    align: "center",
  },
  {
    label: "操作",
    align: "center",
    action: true,
  },
];

// 编辑
const edit = (scope: any) => {
  console.log(scope);
};

// 删除
const remove = (scope: any) => {
  console.log(scope);
};
</script>

<style scoped lang="scss"></style>

```



#### 7. 表格配置项定义自定义列slot

`views/table/index.vue`

```ts
<script lang="ts" setup>
import type { TableOptions } from "../../components/table/src/types";

// 表格数据
const tableData = [
  {
    date: "2016-05-03",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-02",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-04",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-01",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
];

// 表格配置
let options: TableOptions[] = [
  {
    label: "日期",
    prop: "date",
    align: "center",
    slot: "date",
  },
  {
    label: "姓名",
    prop: "name",
    align: "center",
    slot: "name",
  },
  {
    label: "地址",
    prop: "address",
    align: "center",
  },
  {
    label: "操作",
    align: "center",
    action: true,
  },
];

// 编辑
const edit = (scope: any) => {
  console.log(scope);
};

// 删除
const remove = (scope: any) => {
  console.log(scope);
};
</script>
```



#### 8. 渲染自定义列

`components/table/src/index.vue`

```vue
<template>
  <el-table :data="data">
    <template v-for="(item, index) in tableOptions" :key="index">
      <el-table-column
        v-if="!item.slot"
        :label="item.label"
        :prop="item.prop"
        :align="item.align"
        :width="item.width"
      ></el-table-column>
      <el-table-column
        v-else
        :label="item.label"
        :prop="item.prop"
        :align="item.align"
        :width="item.width"
      >
        <template #default="scope">
          <slot :name="item.slot" :scope="scope"></slot>
        </template>
      </el-table-column>
    </template>

    <el-table-column
      :label="actionOptions!.label"
      :align="actionOptions!.align"
      :width="actionOptions!.width"
    >
      <template #default="scope">
        <slot name="action" :scope="scope"></slot>
      </template>
    </el-table-column>
  </el-table>
</template>
```



#### 9. 使用自定义列

```vue
<template>
  <m-table :data="tableData" :options="options">
    <template #date="{ scope }">
      <!--  时间图标 -->
      <el-icon-timer></el-icon-timer>
      <!-- 时间 -->
      {{ scope.row.date }}
    </template>

    <template #name="{ scope }">
      <el-popover
        placement="top-start"
        title="Title"
        :width="200"
        trigger="hover"
        content="this is content, this is content, this is content"
      >
        <template #reference>
          <el-button class="m-2">{{ scope.row.name }}</el-button>
        </template>
      </el-popover>
    </template>
    <template #action="{ scope }">
      <el-button type="primary" size="small" @click="edit(scope)"
        >编辑</el-button
      >
      <el-button type="danger" size="small" @click="remove(scope)"
        >删除</el-button
      >
    </template>
  </m-table>
</template>

<script lang="ts" setup>
import type { TableOptions } from "../../components/table/src/types";

// 表格数据
const tableData = [
  {
    date: "2016-05-03",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-02",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-04",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-01",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
];

// 表格配置
let options: TableOptions[] = [
  {
    label: "日期",
    prop: "date",
    align: "center",
    slot: "date",
  },
  {
    label: "姓名",
    prop: "name",
    align: "center",
    slot: "name",
  },
  {
    label: "地址",
    prop: "address",
    align: "center",
  },
  {
    label: "操作",
    align: "center",
    action: true,
  },
];

// 编辑
const edit = (scope: any) => {
  console.log(scope);
};

// 删除
const remove = (scope: any) => {
  console.log(scope);
};
</script>

<style scoped lang="scss">
svg {
  width: 1em;
  height: 1em;
}
</style>

```



## 6-6 表格组件-为表格加上 loading 效果

#### 1. 给表格添加v-loading

```
 <el-table :data="data" v-loading="isLoading">
```



#### 2. 设置表格是否加载的状态

```ts
<script lang="ts" setup>
import { computed, type PropType } from "vue";
import type { TableOptions } from "./types";

let props = defineProps({
  // 表格配置项
  options: {
    type: Array as PropType<TableOptions[]>,
    required: true,
  },
  // 表格数据
  data: {
    type: Array as PropType<any[]>,
    required: true,
  },
});

// 过滤操作项配置
let tableOptions = computed(() => {
  return props.options.filter((item) => !item.action);
});

// 找出操作项配置
let actionOptions = computed(() => {
  return props.options.find((item) => item.action);
});

// 表格是否加载中
let isLoading = computed(() => !props.data || !props.data.length);
</script>

```



#### 3. 使用定时器模拟数据延迟加载

```ts
<script lang="ts" setup>
import { ref } from "vue";
import type { TableOptions } from "../../components/table/src/types";

// 表格数据
interface TableData {
  date: string;
  name: string;
  address: string;
}

let tableData = ref<TableData[]>([]);

setTimeout(() => {
  tableData.value = [
    {
      date: "2016-05-03",
      name: "Tom",
      address: "No. 189, Grove St, Los Angeles",
    },
    {
      date: "2016-05-02",
      name: "Tom",
      address: "No. 189, Grove St, Los Angeles",
    },
    {
      date: "2016-05-04",
      name: "Tom",
      address: "No. 189, Grove St, Los Angeles",
    },
    {
      date: "2016-05-01",
      name: "Tom",
      address: "No. 189, Grove St, Los Angeles",
    },
  ];
}, 3000);

// 表格配置
let options: TableOptions[] = [
  {
    label: "日期",
    prop: "date",
    align: "center",
    slot: "date",
  },
  {
    label: "姓名",
    prop: "name",
    align: "center",
    slot: "name",
  },
  {
    label: "地址",
    prop: "address",
    align: "center",
  },
  {
    label: "操作",
    align: "center",
    action: true,
  },
];

// 编辑
const edit = (scope: any) => {
  console.log(scope);
};

// 删除
const remove = (scope: any) => {
  console.log(scope);
};
</script>
```



#### 4. 配置loading加载其他相关指令

| 名称                       | 说明                                             | 类型                  |
| :------------------------- | :----------------------------------------------- | :-------------------- |
| v-loading                  | 是否显示动画                                     | `boolean` / `Options` |
| element-loading-text       | 显示在加载图标下方的加载文案                     | `string`              |
| element-loading-spinner    | 自定义加载图标                                   | `string`              |
| element-loading-svg        | 自定义加载图标 (与 element-loading-spinner 相同) | `string`              |
| element-loading-background | 背景遮罩的颜色                                   | `string`              |

```vue
<template>
  <el-table
    :data="data"
    v-loading="isLoading"
    :element-loading-text="elementLoadingText"
    :element-loading-spinner="elementLoadingSpinner"
    :element-loading-background="elementLoadingBackground"
    :element-loading-svg="elementLoadingSvg"
    :element-loading-svg-view-box="elementLoadingSvgViewBox"
  >
    <template v-for="(item, index) in tableOptions" :key="index">
      <el-table-column
        v-if="!item.slot"
        :label="item.label"
        :prop="item.prop"
        :align="item.align"
        :width="item.width"
      ></el-table-column>
      <el-table-column
        v-else
        :label="item.label"
        :prop="item.prop"
        :align="item.align"
        :width="item.width"
      >
        <template #default="scope">
          <slot :name="item.slot" :scope="scope"></slot>
        </template>
      </el-table-column>
    </template>

    <el-table-column
      :label="actionOptions!.label"
      :align="actionOptions!.align"
      :width="actionOptions!.width"
    >
      <template #default="scope">
        <slot name="action" :scope="scope"></slot>
      </template>
    </el-table-column>
  </el-table>
</template>

<script lang="ts" setup>
import { computed, type PropType } from "vue";
import type { TableOptions } from "./types";

let props = defineProps({
  // 表格配置项
  options: {
    type: Array as PropType<TableOptions[]>,
    required: true,
  },
  // 表格数据
  data: {
    type: Array as PropType<any[]>,
    required: true,
  },
  // 加载文案
  elementLoadingText: {
    type: String,
  },
  // 加载图标名
  elementLoadingSpinner: {
    type: String,
  },
  // 加载背景颜色
  elementLoadingBackground: {
    type: String,
  },
  // 加载图标是svg
  elementLoadingSvg: {
    type: String,
  },
  // 加载团是svg的配置
  elementLoadingSvgViewBox: {
    type: String,
  },
});
```



#### 5. 使用loading加载

```vue
<template>
  <m-table
    :data="tableData"
    :options="options"
    elementLoadingText="加载中..."
    elementLoadingBackground="rgba(0,0,0,.8)"
    :element-loading-svg="svg"
    element-loading-svg-view-box="-10, -10, 50, 50"
  >
    <template #date="{ scope }">
      <!--  时间图标 -->
      <el-icon-timer></el-icon-timer>
      <!-- 时间 -->
      {{ scope.row.date }}
    </template>

    <template #name="{ scope }">
      <el-popover
        placement="top-start"
        title="Title"
        :width="200"
        trigger="hover"
        content="this is content, this is content, this is content"
      >
        <template #reference>
          <el-button class="m-2">{{ scope.row.name }}</el-button>
        </template>
      </el-popover>
    </template>
    <template #action="{ scope }">
      <el-button type="primary" size="small" @click="edit(scope)"
        >编辑</el-button
      >
      <el-button type="danger" size="small" @click="remove(scope)"
        >删除</el-button
      >
    </template>
  </m-table>
</template>

<script lang="ts" setup>
import { ref } from "vue";
import type { TableOptions } from "../../components/table/src/types";

// svg
let svg = `
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>`;
```



## 6-7 表格组件-实现可编辑单元格功能

#### 1. 配置可编辑单元格ts类型

```ts
export interface TableOptions {
  // 字段名称
  prop?: string;
  // 表头
  label: string;
  // 对应列的宽度
  width?: string | number;
  // 对齐方式
  align?: "left" | "center" | "right";
  // 自定义列模板的插槽名
  slot?: string;
  // 是否是操作项
  action?: boolean;
  // 是否可以编辑
  editable?: boolean;
}

```



#### 2. 在表格配置项数据中给日期和地址添加editable属性

```ts
// 表格配置
let options: TableOptions[] = [
  {
    label: "日期",
    prop: "date",
    align: "center",
    slot: "date",
  },
  {
    label: "姓名",
    prop: "name",
    align: "center",
    slot: "name",
    editable: true,
  },
  {
    label: "地址",
    prop: "address",
    align: "center",
    editable: true,
  },
  {
    label: "操作",
    align: "center",
    action: true,
  },
];
```



#### 3. 取消定时器加载数据

```vue
<script lang="ts" setup>
import { ref } from "vue";
import type { TableOptions } from "../../components/table/src/types";

// svg
let svg = `
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>`;

// 表格数据
interface TableData {
  date: string;
  name: string;
  address: string;
}

let tableData = ref<TableData[]>([
  {
    date: "2016-05-03",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-02",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-04",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
  {
    date: "2016-05-01",
    name: "Tom",
    address: "No. 189, Grove St, Los Angeles",
  },
]);

// setTimeout(() => {
//   tableData.value = [
//     {
//       date: "2016-05-03",
//       name: "Tom",
//       address: "No. 189, Grove St, Los Angeles",
//     },
//     {
//       date: "2016-05-02",
//       name: "Tom",
//       address: "No. 189, Grove St, Los Angeles",
//     },
//     {
//       date: "2016-05-04",
//       name: "Tom",
//       address: "No. 189, Grove St, Los Angeles",
//     },
//     {
//       date: "2016-05-01",
//       name: "Tom",
//       address: "No. 189, Grove St, Los Angeles",
//     },
//   ];
// }, 3000);

// 表格配置
let options: TableOptions[] = [
  {
    label: "日期",
    prop: "date",
    align: "center",
    slot: "date",
  },
  {
    label: "姓名",
    prop: "name",
    align: "center",
    slot: "name",
    editable: true,
  },
  {
    label: "地址",
    prop: "address",
    align: "center",
    editable: true,
  },
  {
    label: "操作",
    align: "center",
    action: true,
  },
];

// 编辑
const edit = (scope: any) => {
  console.log(scope);
};

// 删除
const remove = (scope: any) => {
  console.log(scope);
};
</script>
```



#### 4. 优化table-colum-item

```vue
<template>
  <el-table
    :data="data"
    v-loading="isLoading"
    :element-loading-text="elementLoadingText"
    :element-loading-spinner="elementLoadingSpinner"
    :element-loading-background="elementLoadingBackground"
    :element-loading-svg="elementLoadingSvg"
    :element-loading-svg-view-box="elementLoadingSvgViewBox"
  >
    <template v-for="(item, index) in tableOptions" :key="index">
      <el-table-column
        :label="item.label"
        :prop="item.prop"
        :align="item.align"
        :width="item.width"
      >
        <template #default="scope">
          <slot v-if="item.slot" :name="item.slot" :scope="scope"></slot>
          <span v-else>{{ scope.row[item.prop!] }}</span>
        </template>
      </el-table-column>
    </template>

    <el-table-column
      :label="actionOptions!.label"
      :align="actionOptions!.align"
      :width="actionOptions!.width"
    >
      <template #default="scope">
        <slot name="action" :scope="scope"></slot>
      </template>
    </el-table-column>
  </el-table>
</template>
```



#### 5. 渲染编辑图标

```vue
<template>
  <el-table
    :data="data"
    v-loading="isLoading"
    :element-loading-text="elementLoadingText"
    :element-loading-spinner="elementLoadingSpinner"
    :element-loading-background="elementLoadingBackground"
    :element-loading-svg="elementLoadingSvg"
    :element-loading-svg-view-box="elementLoadingSvgViewBox"
  >
    <template v-for="(item, index) in tableOptions" :key="index">
      <el-table-column
        :label="item.label"
        :prop="item.prop"
        :align="item.align"
        :width="item.width"
      >
        <template #default="scope">
          <slot v-if="item.slot" :name="item.slot" :scope="scope"></slot>
          <span v-else>{{ scope.row[item.prop!] }}</span>
          <el-icon-edit class="edit" v-if="item.editable"></el-icon-edit>
        </template>
      </el-table-column>
    </template>

    <el-table-column
      :label="actionOptions!.label"
      :align="actionOptions!.align"
      :width="actionOptions!.width"
    >
      <template #default="scope">
        <slot name="action" :scope="scope"></slot>
      </template>
    </el-table-column>
  </el-table>
</template>
```



#### 6. 设置图标大小

```css
<style scoped lang="scss">
.edit {
  width: 1em;
  height: 1em;
  position: relative;
  top: 2px;
  left: 5px;
  cursor: pointer;
}
</style>
```



#### 7. 给编辑图标绑定事件

```ts
<el-icon-edit @click="clickEdit(scope)" class="edit" v-if="item.editable" ></el-icon-edit>
const clickEdit = (scope: any) => {
  console.log("scope", scope);
};
```



#### 8. 保存点击编辑当前单元格下标与对应列的id

```ts
// 点击编辑图标触发的方法
let currentEdit = ref<string>("");
const clickEdit = (scope: any) => {
  // 唯一的标识
  currentEdit.value = scope.$index + scope.column.id;
  console.log("scope", scope);
};
```



#### 9. 根据点击单元格的唯一标识处理渲染编辑与非编辑状态

```vue
<template>
  <el-table
    :data="data"
    v-loading="isLoading"
    :element-loading-text="elementLoadingText"
    :element-loading-spinner="elementLoadingSpinner"
    :element-loading-background="elementLoadingBackground"
    :element-loading-svg="elementLoadingSvg"
    :element-loading-svg-view-box="elementLoadingSvgViewBox"
  >
    <template v-for="(item, index) in tableOptions" :key="index">
      <el-table-column
        :label="item.label"
        :prop="item.prop"
        :align="item.align"
        :width="item.width"
      >
        <template #default="scope">
          <!-- 编辑状态处理的效果 -->
          <template v-if="scope.$index + scope.column.id === currentEdit">
             <el-input size="small" v-model="scope.row[item.prop!]"></el-input>
          </template>
          <!-- 非编辑状态处理的效果 -->
          <template v-else>
            <slot v-if="item.slot" :name="item.slot" :scope="scope"></slot>
            <span v-else>{{ scope.row[item.prop!] }}</span>
            <el-icon-edit
              @click="clickEdit(scope)"
              class="edit"
              v-if="item.editable"
            ></el-icon-edit>
          </template>
        </template>
      </el-table-column>
    </template>

    <el-table-column
      :label="actionOptions!.label"
      :align="actionOptions!.align"
      :width="actionOptions!.width"
    >
      <template #default="scope">
        <slot name="action" :scope="scope"></slot>
      </template>
    </el-table-column>
  </el-table>
</template>
```



#### 10. 渲染正确与错误图标

```vue
<template>
  <el-table
    :data="data"
    v-loading="isLoading"
    :element-loading-text="elementLoadingText"
    :element-loading-spinner="elementLoadingSpinner"
    :element-loading-background="elementLoadingBackground"
    :element-loading-svg="elementLoadingSvg"
    :element-loading-svg-view-box="elementLoadingSvgViewBox"
  >
    <template v-for="(item, index) in tableOptions" :key="index">
      <el-table-column
        :label="item.label"
        :prop="item.prop"
        :align="item.align"
        :width="item.width"
      >
        <template #default="scope">
          <!-- 编辑状态处理的效果 -->
          <template v-if="scope.$index + scope.column.id === currentEdit">
            <div style="display: flex">
              <el-input size="small" v-model="scope.row[item.prop!]"></el-input>
              <div>
                <div class="action-icon">
                  <el-icon-check
                    class="check"
                  ></el-icon-check>
                  <el-icon-close
                    class="close"
                  ></el-icon-close>
                </div>
              </div>
            </div>
          </template>
          <!-- 非编辑状态处理的效果 -->
          <template v-else>
            <slot v-if="item.slot" :name="item.slot" :scope="scope"></slot>
            <span v-else>{{ scope.row[item.prop!] }}</span>
            <el-icon-edit
              @click="clickEdit(scope)"
              class="edit"
              v-if="item.editable"
            ></el-icon-edit>
          </template>
        </template>
      </el-table-column>
    </template>

    <el-table-column
      :label="actionOptions!.label"
      :align="actionOptions!.align"
      :width="actionOptions!.width"
    >
      <template #default="scope">
        <slot name="action" :scope="scope"></slot>
      </template>
    </el-table-column>
  </el-table>
</template>
```



#### 11. 设置正确与错误图标样式

```css
<style scoped lang="scss">
.edit {
  width: 1em;
  height: 1em;
  position: relative;
  top: 2px;
  left: 5px;
  cursor: pointer;
}
.action-icon {
  display: flex;
  svg {
    width: 1em;
    height: 1em;
    margin-left: 8px;
    position: relative;
    top: 8px;
    cursor: pointer;
  }
  .check {
    color: red;
  }
  .close {
    color: green;
  }
}
</style>

```



#### 12. 给正确与错误图标添加点击事件

1. 点击正确图标,将currentEdit重置为空, 通知父组件我点击了正确图标,并将当前单元行数据传递到父组件
2. 点击错误图标,将currentEdit重置为空,通知父组件我点击了错误图标,并将当前单元行数据传递到父组件

```ts
<div class="action-icon" v-else>
  <el-icon-check class="check" @click="check(scope)"></el-icon-check>
  <el-icon-close class="close" @click="close(scope)"></el-icon-close>
</div>

let emits = defineEmits(["confirm", "cancel"]);
// 点击确认
let check = (scope: any) => {
  emits("confirm", scope);
  currentEdit.value = "";
};
// 点击取消
let close = (scope: any) => {
  emits("cancel", scope);
  currentEdit.value = "";
};
```



#### 13. 在父组件监听正确与错误图标的事件

```ts
  <m-table
    :data="tableData"
    :options="options"
    elementLoadingText="加载中..."
    elementLoadingBackground="rgba(0,0,0,.8)"
    :element-loading-svg="svg"
    element-loading-svg-view-box="-10, -10, 50, 50"
    @confirm="check"
    @cancel="close"
  >
  
  
  // 监听点击了正确图标
let check = (scope: any) => {
  console.log("父组件", scope);
};
// 监听点击了错误图标
let close = (scope: any) => {
  console.log("父组件", scope);
};
```



#### 14. 通过组件传值的方式自定义编辑图标

```
// 编辑显示的图标
  editIcon: {
    type: String,
    default: 'Edit'
  },
  
```

```vue
<template v-else>
              <slot v-if="item.slot" :name="item.slot" :scope="scope"></slot>
              <span v-else>{{ scope.row[item.prop!] }}</span>
              <component
                :is="`el-icon-${toLine(editIcon)}`"
                class="edit"
                v-if="item.editable"
                @click.stop="clickEditIcon(scope)"
              ></component>
 </template>
```



#### 15. 通过插槽的方式自定义图标

```vue
  <template v-if="(scope.$index + scope.column.id) === currentEdit">
              <div style="display: flex">
                <el-input size="small" v-model="scope.row[item.prop!]"></el-input>
                <div>
                  <slot name="cellEdit" v-if="$slots.cellEdit" :scope="scope"></slot>
                  <div class="action-icon" v-else>
                    <el-icon-check class="check" @click.stop="check(scope)"></el-icon-check>
                    <el-icon-close class="close" @click.stop="close(scope)"></el-icon-close>
                  </div>
                </div>
              </div>
</template>
```



## 6-8 表格组件-实现可编辑行功能-1

#### 1. 在table组件defineProps定义是否可以编辑行参数

```ts
 // 是否可以编辑行
  isEditRow: {
    type: Boolean,
    default: false,
  },
```

#### 2. 在table组件defineProps定义编辑行按钮的标识

```ts
// 编辑行的按钮标识
  editRowIndex: {
    type: String,
    default: "",
  }
```

#### 3. 父组件设置可以编辑行参数

```vue
 <m-table
      :data="tableData"
      :element-loading-svg="svg"
      :options="options"
      element-loading-svg-view-box="-10, -10, 50, 50"
      elementLoadingBackground="rgba(0,0,0,.8)"
      elementLoadingText="加载中..."
      isEditRow
      @cancel="close"
      @confirm="check"
  >
```

#### 4.父组件设置当前点击的按钮标识

```vue
<m-table
      :data="tableData"
      :editRowIndex="editRowIndex"
      :element-loading-svg="svg"
      :options="options"
      element-loading-svg-view-box="-10, -10, 50, 50"
      elementLoadingBackground="rgba(0,0,0,.8)"
      elementLoadingText="加载中..."
      isEditRow
      @cancel="close"
      @confirm="check"
  >
  
  <script lang="ts" setup>
import {ref} from "vue";
import type {TableOptions} from "../../components/table/src/types";

// 设置当前点击的按钮标识为edit
let editRowIndex = ref<string>("edit")
```



#### 5. 深拷贝表格数据与按钮标识数据

```ts
// 拷贝一份表格的数据
let tableData = ref<any[]>(cloneDeep(props.data))

// 拷贝一份按钮的标识
let cloneEditRowIndex = ref<string>(cloneDeep(props.editRowIndex))

<el-table
      v-loading="isLoading"
      :data="tableData"
      :element-loading-background="elementLoadingBackground"
      :element-loading-spinner="elementLoadingSpinner"
      :element-loading-svg="elementLoadingSvg"
      :element-loading-svg-view-box="elementLoadingSvgViewBox"
      :element-loading-text="elementLoadingText"
  >
```



#### 6. 给表格的每一行数据添加一个属性, 默认为false,不可编辑状态

```ts
// 表格数据项
onMounted(() => {
  tableData.value.map(item => {
    // 代表当前是否是可编辑状态
    item.rowEdit = false
  })
})
```



#### 7. 监听父组件传递过来的数据

```ts
// 监听父组件传递过来的数据
watch(() => props.data, (val: any[]) => {
  tableData.value = cloneDeep(val)
  tableData.value.map(item => {
    // 代表当前是否是可编辑状态
    item.rowEdit = false
  })
}, {deep: true})
```



#### 8.  监听父组件传递过来的按钮标识

```ts
// 监听父组件传递过来的按钮标识
watch(() => props.editRowIndex, (val: string) => {
  cloneEditRowIndex.value = cloneDeep(val)
}, {deep: true})
```



#### 9. 给表格绑定点击每一行触发的事件和方法

```ts
// 点击每一行触发的方法
const rowClick = (row: any, column: any) => {
  console.log("row", row)
  console.log("column", column)
  // 判断当前点击的是否是操作项
  if (column.label === actionOptions.value.label) {
    console.log("点击的是操作项:", 123)
  }
}

<el-table
      v-loading="isLoading"
      :data="tableData"
      :element-loading-background="elementLoadingBackground"
      :element-loading-spinner="elementLoadingSpinner"
      :element-loading-svg="elementLoadingSvg"
      :element-loading-svg-view-box="elementLoadingSvgViewBox"
      :element-loading-text="elementLoadingText"
      @row-click="rowClick"
  >
```



## 6-9 表格组件-实现可编辑行功能-2

#### 1.  父组件设置当点击编辑按钮时, editRowIndex的值为edit

```ts
const edit = (scope: any) => {
  console.log(scope);
  editRowIndex.value = 'edit'
};

```

#### 2. 设置如果点击的是当前行的编辑按钮, 则将当前行的每个数据变成可编辑的状态

```ts
let rowClick = (row: any, column: any) => {
  // 判断是否是点击的操作项
  if (column.label === actionOptions.value!.label) {
    if (props.isEditRow && props.editRowIndex === 'edit') {
      // 编辑行的操作
      row.rowEdit = !row.rowEdit
      console.log("eow", row)
      // 重置其他数据的rowEdit
      tableData.value.map(item => {
        if (item !== row) item.rowEdit = false
      })
      // 重置按钮的标识
      if (!row.rowEdit) emits('update:editRowIndex', '')
    }
  }
}
```



#### 3. 根据可编辑行的状态渲染编辑与非编辑效果

```vue
<template>
  <el-table
      v-loading="isLoading"
      :data="tableData"
      :element-loading-background="elementLoadingBackground"
      :element-loading-spinner="elementLoadingSpinner"
      :element-loading-svg="elementLoadingSvg"
      :element-loading-svg-view-box="elementLoadingSvgViewBox"
      :element-loading-text="elementLoadingText"
      @row-click="rowClick"
  >
    <template v-for="(item, index) in tableOptions" :key="index">
      <el-table-column
          :align="item.align"
          :label="item.label"
          :prop="item.prop"
          :width="item.width"
      >
        <template #default="scope">
          <!--编辑行编辑状态-->
          <template v-if="scope.row.rowEdit">
						<el-input v-model="scope.row[item.prop!]" size="small"></el-input>
					</template>
          <!-- 非编辑行编辑状态-->
          <template v-else>
            <!-- 编辑状态处理的效果 -->
            <template v-if="scope.$index + scope.column.id === currentEdit">
              <div style="display: flex">
                <el-input v-model="scope.row[item.prop!]" size="small"></el-input>
                <div>
                  <slot
                      v-if="$slots.cellEdit"
                      :scope="scope"
                      name="cellEdit"
                  ></slot>
                  <div v-else class="action-icon">
                    <el-icon-check
                        class="check"
                        @click="check(scope)"
                    ></el-icon-check>
                    <el-icon-close
                        class="close"
                        @click="close(scope)"
                    ></el-icon-close>
                  </div>
                </div>
              </div>
            </template>
            <!-- 非编辑状态处理的效果 -->
            <template v-else>
              <slot v-if="item.slot" :name="item.slot" :scope="scope"></slot>
              <span v-else>{{ scope.row[item.prop!] }}</span>
              <el-icon-edit
                  v-if="item.editable"
                  class="edit"
                  @click="clickEdit(scope)"
              ></el-icon-edit>
            </template>
          </template>
        </template>
      </el-table-column>
    </template>

    <el-table-column
        :align="actionOptions!.align"
        :label="actionOptions!.label"
        :width="actionOptions!.width"
    >
      <template #default="scope">
        <slot :scope="scope" name="action"></slot>
      </template>
    </el-table-column>
  </el-table>
</template>
```



#### 4. 使用插槽在子组件设置操作项进入可编辑状态按钮的展示

```ts
<!-- 操作项-->
    <el-table-column
        :align="actionOptions!.align"
        :label="actionOptions!.label"
        :width="actionOptions!.width"
    >
      <template #default="scope">
        <slot v-if="scope.row.rowEdit" :scope="scope" name="editRow"></slot>
        <slot v-else :scope="scope" name="action"></slot>
      </template>
    </el-table-column>
```

#### 5. 父组件渲染可编辑状态按钮

```vue
<template>
  <m-table
      :data="tableData"
      :editRowIndex="editRowIndex"
      :element-loading-svg="svg"
      :options="options"
      element-loading-svg-view-box="-10, -10, 50, 50"
      elementLoadingBackground="rgba(0,0,0,.8)"
      elementLoadingText="加载中..."
      isEditRow
      @cancel="close"
      @confirm="check"

  >
    <template #date="{ scope }">
      <!--  时间图标 -->
      <el-icon-timer></el-icon-timer>
      <!-- 时间 -->
      {{ scope.row.date }}
    </template>

    <template #name="{ scope }">
      <el-popover
          :width="200"
          content="this is content, this is content, this is content"
          placement="top-start"
          title="Title"
          trigger="hover"
      >
        <template #reference>
          <el-button class="m-2">{{ scope.row.name }}</el-button>
        </template>
      </el-popover>
    </template>
    <template #action="{ scope }">
      <el-button size="small" type="primary" @click="edit(scope)"
      >编辑
      </el-button
      >
      <el-button size="small" type="danger" @click="remove(scope)"
      >删除
      </el-button
      >
    </template>
    <template #editRow="{ scope }">
      <el-button size="small" type="primary">确认
      </el-button
      >
      <el-button size="small" type="danger"
      >取消
      </el-button
      >
    </template>
  </m-table>
</template>
```



## 6-10 表格组件-修复冒泡事件带来的问题

#### 1. 修复点击删除按钮也进入可编辑状态的问题

```ts
let emits = defineEmits(["confirm", "cancel", "update:editRowIndex"]);
let rowClick = (row: any, column: any) => {
  // 判断是否是点击的操作项
  if (column.label === actionOptions.value!.label) {
    if (props.isEditRow && props.editRowIndex === 'edit') {
      // 编辑行的操作
      row.rowEdit = !row.rowEdit
      console.log("eow", row)
      // 重置其他数据的rowEdit
      tableData.value.map(item => {
        if (item !== row) item.rowEdit = false
      })
      // 重置按钮的标识
      if (!row.rowEdit) emits('update:editRowIndex', '')
    }
  }
}
```



#### 2. 使用阻止事件冒泡解决单个单元格编辑点击正确或者错误图标报错问题

```vue
<template>
  <el-table
      v-loading="isLoading"
      :data="tableData"
      :element-loading-background="elementLoadingBackground"
      :element-loading-spinner="elementLoadingSpinner"
      :element-loading-svg="elementLoadingSvg"
      :element-loading-svg-view-box="elementLoadingSvgViewBox"
      :element-loading-text="elementLoadingText"
      @row-click="rowClick"
  >
    <template v-for="(item, index) in tableOptions" :key="index">
      <el-table-column
          :align="item.align"
          :label="item.label"
          :prop="item.prop"
          :width="item.width"
      >
        <template #default="scope">
          <!--编辑行编辑状态-->
          <template v-if="scope.row.rowEdit">
            <el-input v-model="scope.row[item.prop!]" size="small"></el-input>
          </template>
          <!-- 非编辑行编辑状态-->
          <template v-else>
            <!-- 编辑状态处理的效果 -->
            <template v-if="(scope.$index + scope.column.id) === currentEdit">
              <div style="display: flex">
                <el-input v-model="scope.row[item.prop!]" size="small"></el-input>
                <div>
                  <slot
                      v-if="$slots.cellEdit"
                      :scope="scope"
                      name="cellEdit"
                  ></slot>
                  <div v-else class="action-icon">
                    <el-icon-check
                        class="check"
                        @click.stop="check(scope)"
                    ></el-icon-check>
                    <el-icon-close
                        class="close"
                        @click.stop="close(scope)"
                    ></el-icon-close>
                  </div>
                </div>
              </div>
            </template>
            <!-- 非编辑状态处理的效果 -->
            <template v-else>
              <slot v-if="item.slot" :name="item.slot" :scope="scope"></slot>
              <span v-else>{{ scope.row[item.prop!] }}</span>
              <el-icon-edit
                  v-if="item.editable"
                  class="edit"
                  @click.stop="clickEdit(scope)"
              ></el-icon-edit>
            </template>
          </template>
        </template>
      </el-table-column>
    </template>

    <!-- 操作项-->
    <el-table-column
        :align="actionOptions!.align"
        :label="actionOptions!.label"
        :width="actionOptions!.width"
    >
      <template #default="scope">
        <slot v-if="scope.row.rowEdit" :scope="scope" name="editRow"></slot>
        <slot v-else :scope="scope" name="action"></slot>
      </template>
    </el-table-column>
  </el-table>
</template>
```

## 6-11 表格组件-实现表格分页功能

#### 1. 引入mock



#### 2. 安装mock依赖



#### 3. 清空tabledata的数据



#### 4. 定义页码和条数以及总条数



#### 5. 通过axios请求数据



#### 6. 添加分页组件



#### 7. 定义分页组件需要的属性与方法



#### 8. 定义是否显示分页



### 最终代码

```vue
<template>
  <m-table
    :options="options"
    :data="tableData"
    elementLoadingText="加载中..."
    elementLoadingBackground="rgba(0,0,0,.8)"
    :element-loading-svg="svg"
    element-loading-svg-view-box="-10, -10, 50, 50"
    isEditRow
    pagination
    stripe
    border
    :total="total"
    :currentPage="current"
    :pageSize="pageSize"
    v-model:editRowIndex="editRowIndex"
    @confirm="confirm"
    @size-change="handleSizeChange"
    @current-change="handleCurrentChange"
  >
    <template #date="{ scope }">
      <el-icon-timer></el-icon-timer>
      <span style="margin-left: 10px">{{ scope.row.date }}</span>
    </template>
    <template #name="{ scope }">
      <el-popover effect="light" trigger="hover" placement="top">
        <template #default>
          <p>姓名: {{ scope.row.name }}</p>
          <p>住址: {{ scope.row.address }}</p>
        </template>
        <template #reference>
          <div class="name-wrapper">
            <el-tag size="medium">{{ scope.row.name }}</el-tag>
          </div>
        </template>
      </el-popover>
    </template>
    <template #editRow="scope">
      <el-button size="small" type="primary" @click="sure(scope.scope)">确认</el-button>
      <el-button size="small" type="danger">取消</el-button>
    </template>
    <template #action="scope">
      <el-button size="small" type="primary" @click="edit(scope.scope)">编辑</el-button>
      <el-button size="small" type="danger">删除</el-button>
    </template>
  </m-table>
</template>

<script lang='ts' setup>
import { TableOptions } from '../../components/table/src/types'
import { ref, onMounted } from 'vue'
import axios from 'axios'

let options: TableOptions[] = [
  {
    prop: 'date',
    label: '日期',
    // width: '180',
    align: 'center',
    slot: 'date',
    editable: true
  },
  {
    prop: 'name',
    label: '姓名',
    // width: '180',
    align: 'center',
    slot: 'name'
  },
  {
    prop: 'address',
    label: '地址',
    align: 'center',
    editable: true
  },
  {
    label: '操作',
    action: true,
    align: 'center'
  }
]
let tableData = ref<any[]>([])
let editRowIndex = ref<string>('')
let svg = `
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>
      `
// setTimeout(() => {
// tableData.value = [
//   {
//     date: '2016-05-03',
//     name: 'Tom1',
//     address: 'No. 189, Grove St, Los Angeles',
//   },
//   {
//     date: '2016-05-02',
//     name: 'Tom2',
//     address: 'No. 189, Grove St, Los Angeles',
//   },
//   {
//     date: '2016-05-04',
//     name: 'Tom3',
//     address: 'No. 189, Grove St, Los Angeles',
//   },
//   {
//     date: '2016-05-01',
//     name: 'Tom4',
//     address: 'No. 189, Grove St, Los Angeles',
//   },
// ]
// }, 3000)

let current = ref<number>(1)
let pageSize = ref<number>(10)
let total = ref<number>(0)
let getData = () => {
  axios.post('/api/list', {
    current: current.value,
    pageSize: pageSize.value,
  }).then((res: any) => {
    if (res.data.code === '200') {
      tableData.value = res.data.data.rows
      total.value = res.data.data.total
      console.log(res.data.data)
    }
  })
}
let handleSizeChange = (val: number) => {
  pageSize.value = val
  getData()
}
let handleCurrentChange = (val: number) => {
  current.value = val
  getData()
}
onMounted(() => {
  getData()
})


let edit = (scope: any) => {
  // console.log(scope)
  editRowIndex.value = 'edit'
}
let sure = (scope: any) => {
  console.log(scope)
}
let confirm = (scope: any) => {
  // console.log(scope)
}
</script>

<style lang='scss' scoped>
svg {
  width: 1em;
  height: 1em;
}
</style>
```

```vue
<template>
  <el-table
    :data="tableData"
    v-loading="isLoading"
    :element-loading-text="elementLoadingText"
    :element-loading-spinner="elementLoadingSpinner"
    :element-loading-background="elementLoadingBackground"
    :element-loading-svg="elementLoadingSvg"
    :element-loading-svg-view-box="elementLoadingSvgViewBox"
    @row-click="rowClick"
    v-bind="$attrs"
  >
    <template v-for="(item, index) in tableOption" :key="index">
      <el-table-column
        v-if="item.prop && !item.action"
        :label="item.label"
        :prop="item.prop"
        :width="item.width"
        :align="item.align"
      >
        <template #default="scope">
          <template v-if="scope.row.rowEdit">
            <el-input size="small" v-model="scope.row[item.prop!]"></el-input>
          </template>
          <template v-else>
            <template v-if="(scope.$index + scope.column.id) === currentEdit">
              <div style="display: flex">
                <el-input size="small" v-model="scope.row[item.prop!]"></el-input>
                <div>
                  <slot name="cellEdit" v-if="$slots.cellEdit" :scope="scope"></slot>
                  <div class="action-icon" v-else>
                    <el-icon-check class="check" @click.stop="check(scope)"></el-icon-check>
                    <el-icon-close class="close" @click.stop="close(scope)"></el-icon-close>
                  </div>
                </div>
              </div>
            </template>
            <template v-else>
              <slot v-if="item.slot" :name="item.slot" :scope="scope"></slot>
              <span v-else>{{ scope.row[item.prop!] }}</span>
              <component
                :is="`el-icon-${toLine(editIcon)}`"
                class="edit"
                v-if="item.editable"
                @click.stop="clickEditIcon(scope)"
              ></component>
            </template>
          </template>
        </template>
      </el-table-column>
    </template>
    <el-table-column
      :label="actionOption!.label"
      :width="actionOption!.width"
      :align="actionOption!.align"
    >
      <template #default="scope">
        <slot name="editRow" :scope="scope" v-if="scope.row.rowEdit"></slot>
        <slot name="action" :scope="scope" v-else></slot>
      </template>
    </el-table-column>
  </el-table>

  <div v-if="pagination && !isLoading" class="pagination" :style="{ justifyContent }">
    <el-pagination
      v-model:currentPage="currentPage"
      :page-sizes="pageSizes"
      :page-size="pageSize"
      layout="total, sizes, prev, pager, next, jumper"
      :total="total"
      @size-change="handleSizeChange"
      @current-change="handleCurrentChange"
    ></el-pagination>
  </div>
</template>

<script lang='ts' setup>
import { PropType, computed, ref, watch, onMounted } from 'vue'
import { TableOptions } from './types'
import { toLine } from '../../../utils'
import cloneDeep from 'lodash/cloneDeep'

let props = defineProps({
  // 表格配置选项
  options: {
    type: Array as PropType<TableOptions[]>,
    required: true
  },
  // 表格数据
  data: {
    type: Array,
    required: true
  },
  // 加载文案
  elementLoadingText: {
    type: String,
  },
  // 加载图标名
  elementLoadingSpinner: {
    type: String,
  },
  // 加载背景颜色
  elementLoadingBackground: {
    type: String,
  },
  // 加载图标是svg
  elementLoadingSvg: {
    type: String
  },
  // 加载团是svg的配置
  elementLoadingSvgViewBox: {
    type: String,
  },
  // 编辑显示的图标
  editIcon: {
    type: String,
    default: 'Edit'
  },
  // 是否可以编辑行
  isEditRow: {
    type: Boolean,
    default: false
  },
  // 编辑行按钮的标识
  editRowIndex: {
    type: String,
    default: ''
  },
  // 是否显示分页
  pagination: {
    type: Boolean,
    default: false
  },
  // 显示分页的对齐方式
  paginationAlign: {
    type: String as PropType<'left' | 'center' | 'right'>,
    default: 'left'
  },
  // 当前是第几页
  currentPage: {
    type: Number,
    default: 1
  },
  // 当前一页多少条数据
  pageSize: {
    type: Number,
    default: 10
  },
  // 显示分页数据多少条的选项
  pageSizes: {
    type: Array,
    default: () => [10, 20, 30, 40]
  },
  // 数据总条数
  total: {
    type: Number,
    default: 0
  }
})

let emits = defineEmits(['confirm', 'cancel', 'update:editRowIndex', 'size-change', 'current-change'])

// 分页的每一页数据变化
let handleSizeChange = (val: number) => {
  emits('size-change', val)
  // console.log(val)
}
// 分页页数改变
let handleCurrentChange = (val: number) => {
  emits('current-change', val)
  // console.log(val)
}

// 当前被点击的单元格的标识
let currentEdit = ref<string>('')

// 拷贝一份表格的数据
let tableData = ref<any[]>(cloneDeep(props.data))
// 拷贝一份按钮的标识
let cloneEditRowIndex = ref<string>(props.editRowIndex)
// 监听的标识
let watchData = ref<boolean>(false)

// 如果data的数据变了 要重新给tableData赋值
// 只需要监听一次就可以了
let stopWatchData =  watch(() => props.data, val => {
  watchData.value = true
  tableData.value = val
  tableData.value.map(item => {
    item.rowEdit = false
  })
  if (watchData.value) stopWatchData()
}, { deep: true })

// 监听
watch(() => props.editRowIndex, val => {
  if (val) cloneEditRowIndex.value = val
})

onMounted(() => {
  tableData.value.map(item => {
    item.rowEdit = false
  })
})

// 过滤操作项之后的配置
let tableOption = computed(() => props.options.filter(item => !item.action))
// 操作项
let actionOption = computed(() => props.options.find(item => item.action))

// 是否在加载中
let isLoading = computed(() => !props.data || !props.data.length)

// 表格分页的排列方式
let justifyContent = computed(() => {
  if (props.paginationAlign === 'left') return 'flex-start'
  else if (props.paginationAlign === 'right') return 'flex-end'
  else return 'center'
})

// 点击编辑图标
let clickEditIcon = (scope: any) => {
  // 会做一个判断 判断是否当前单元格被点击了
  // 拼接$index和column的id
  currentEdit.value = scope.$index + scope.column.id
  // console.log(currentEdit.value)
}

// 点击确认
let check = (scope: any) => {
  emits('confirm', scope)
  currentEdit.value = ''
}
// 点击取消
let close = (scope: any) => {
  emits('cancel', scope)
  currentEdit.value = ''
}

// 点击行的事件
let rowClick = (row: any, column: any) => {
  // 判断是否是点击的操作项
  if (column.label === actionOption.value!.label) {
    if (props.isEditRow && cloneEditRowIndex.value === props.editRowIndex) {
      // 编辑行的操作
      row.rowEdit = !row.rowEdit
      // 重置其他数据的rowEdit
      tableData.value.map(item => {
        if (item !== row) item.rowEdit = false
      })
      // 重置按钮的标识
      if (!row.rowEdit) emits('update:editRowIndex', '')
    }
  }
}
</script>



<style lang='scss' scoped>
.edit {
  width: 1em;
  height: 1em;
  position: relative;
  top: 2px;
  left: 12px;
  cursor: pointer;
}
.action-icon {
  display: flex;
  svg {
    width: 1em;
    height: 1em;
    margin-left: 8px;
    position: relative;
    top: 8px;
    cursor: pointer;
  }
  .check {
    color: red;
  }
  .close {
    color: green;
  }
}
.pagination {
  margin-top: 16px;
  display: flex;
}
</style>
```



## 6-12 拓展表格排序功能

**题目描述:**
通过前面的章节，我们已经完成了表格组件，那我们就给表格添加排序功能。
**提示:**

1. 给表格配置新增`sortable`属性。
2. 根据`sortable`属性来对表格进行排序操作。

## 6-13 拓展表格单选功能

**题目描述:**
通过前面的章节，我们已经完成了表格组件，那我们就给表格添加单选功能。
**提示:**

1. 给表格配置新增`highlight-current-row`属性。
2. 根据`current-change`事件来管理选中时触发的事件。

## 6-14 拓展表格多选功能

**题目描述:**
通过前面的章节，我们已经完成了表格组件，那我们就给表格添加多选功能。
**提示:**

1. 给表格手动添加一个`el-table-column`，设 `type` 属性为 `selection` 即可。
2. 根据`selection-change`事件来管理选中时触发的事件。

## 6-15 本章回顾

## 本章回顾

我们一起来回顾本章的重点内容

- 表格组件
  - 配置项类型定义
  - 插槽的使用
  - 如何添加自定义`loading`效果
  - 如何实现单元格编辑
  - 如何实现行编辑
  - 如何实现表格分页
  - 完善表格逻辑
